---
title: 'Lab 1: Question 1'
author: "Yao Chen, Jenny Conde, Satheesh Joseph, Paco Valdez, Yi Zhang"
output: pdf_document
---

```{r load packages, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2) 
library(tidyverse) # if you want more, but still core, toolkit
library(haven)
```

```{r load and clean data, echo=FALSE, warning=TRUE, message=FALSE}
# Load data
df <- read_dta('data/anes_timeseries_2020_stata_20210211.dta')

# Pick out the useful variables
# V201018 -- PRE: PARTY OF REGISTRATION
# V201507x -- PRE: SUMMARY: RESPONDENT AGE
df_small <- data.frame(party=df$V201018, age=df$V201507x)

DEMOCRATS <- 1
REPUBLICANS <- 2

# Clean up the data
df_clean <- df_small
df_clean <- df_clean[df_clean$age > 0,] # Remove non-respondent for age
df_clean <- df_clean[(df_clean$party == DEMOCRATS | df_clean$party == REPUBLICANS),] # Only include D or R
```


## Importance and Context
The 2020 general election was very different from the ones that came before.
It happened in the middle of a pandemic. It elected the first ever female VP.
And it might have been the most polarized election in recent American history.
What drove people apart, among other things, is their age.

Many people suspected that the Republicans have an older supporter base than the
Democrats.

Is it just a myth or does it have some truth to it? That is what we're going to find
out in this section, using the comprehensive 2020 Time Series Study from ANES
(American National Election Studies).

## Description of Data
From the ANES data set gathered before the election, there are 2 variables that
are particularly relevant for us to answer this question, they are:

- `V201018`: `PARTY OF REGISTRATION`

- `V201507x`: `SUMMARY: RESPONDENT AGE`

We noticed for both variables, there are irrelevant answers in the data set.
For `PARTY OF REGISTRATION`, we'll only keep Democrats and Republicans, and remove
other parties as well as other non-answers, because we're only interested in the
supporters of these two parties.

Similarly, for `SUMMARY: RESPONDENT AGE`, we will remove people who refused to answer.

After these cleanup operations, we are left with only $3074$ observations to work with.

Looking at their summaries, it looks like the variables are now all in the correct range.

``` {r echo=FALSE}
summary(df_clean)
```

From the following graphs, we can see that the number of Democrats and Republicans are not too disparate and the Age
distribution is not very skewed.

Notice the age number has a hard cutoff at 80 due to the way the survey is constructed, so
everyone above age 80 simply gets grouped into "80 or older" group, so actually the mean
age is somewhat under-representing the true average age of the participants.

``` {r echo=FALSE}
par(mfrow=c(1, 2))
pie(table(df_clean$party), main="Participants Party Afflication", labels=c('Democrats', 'Republicans'))
hist(df_clean$age, main="Participants Age distribution", xlab = "age group", ylab = "Number of people")
```


## Most appropriate test
The unpaired t-test seems to be the most appropriate to answer this question.

1. Even though there are only 3074 valid samples, it is still large enough for the CTE to apply
on the sample average, so it satisfies the normality condition

2. Given the sampling frame based on a cross-section of registered addresses across 50 states
and the District of Columbia, we feel the data are sufficiently close to be i.i.d.

3. And of course `age` is a metric scale variable.

Furthermore, because we're comparing two distinct groups of people with no natural
pairing between them, this directs us to the unpaired t-test.

## Test, results and interpretation
For the test itself, we establish the *null hypothesis* to be that the average age
of Democrats and Republicans are the same.

And *the alternative hypothesis* is that they're not.
Given there is no bias towards either side, this should be a two tailed test.

We'll be using the standard $5%$ significance level.

``` {r}
t.test(df_clean$age ~ df_clean$party)
```

From the test, it looks like we have a very very small p-value, representing a highly
significant result.

This gives us evidence to reject the null hypothesis in favor of the alternative and
believe that the average age of the Democrats and the Republicans are indeed different,
given the data and a 5% significance level.

Practically, as can be seen above, the average age of a Republican is more than 3 years
older than a Democrat.

Plotting the distribution of ages within each group, it's clear that Democrats
participants are more evenly distributed between "young" and "old" whereas Republicans
are much more skewed towards people above 60.

At the same time, there are larger proportion of Democrats in the entire age group
between 18 and 50 than Republicans and vice versa for over 50.

```{r, echo = FALSE, warning=FALSE, message=FALSE}
# Add categorical variable indicating Democratic or Republican
df_clean <- mutate(df_clean, party_affiliation = ifelse(party == 1, "Democratic Party", "Republican Party"))

# Find average age in each political party
av_ages <- df_clean %>%
  group_by(party_affiliation) %>%
  summarize(av_age = mean(age))

# Create density plot showing age distributions of the two parties
df_clean %>%
  ggplot() +
  aes(x = age, color = party_affiliation) +
  geom_density() + 
  geom_vline(data = av_ages, aes(xintercept=av_age, 
                                 color = party_affiliation),
             linetype = "dashed") +
  scale_color_manual(values = c("blue2", "red2")) + 
  labs(title = "Distribution of ages across political parties",
       caption = "The dotted lines represent the average age in each respective political party.") +
  theme_minimal()
```

More quantitatively, if we look at the correlation between the two groups, we see that
there is a mild correlation, meaning that there is mildly strong (linear) relationship
between the political party affiliation and age.

``` {r}
cor(df_clean$party, df_clean$age)
```

