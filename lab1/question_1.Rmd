---
title: 'Lab 1: Question 1'
author: "Yao Chen, Jenny Conde, Satheesh Joseph, Paco Valdez, Yi Zhang"
output: pdf_document
---

```{r load packages, echo=FALSE, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2) 
library(tidyverse) # if you want more, but still core, toolkit
library(haven)
```

```{r load and clean data, echo=FALSE, warning=TRUE, message=FALSE}
# Load data
df <- read_dta('data/anes_timeseries_2020_stata_20210211.dta')

# Pick out the useful variables
# V201018 -- PRE: PARTY OF REGISTRATION
# V201507x -- PRE: SUMMARY: RESPONDENT AGE
df_small <- data.frame(party=df$V201018, age=df$V201507x)

# Clean up the data
df_clean <- df_small
df_clean <- df_clean[df_clean$age > 0,] # Remove non-respondent for age
df_clean <- df_clean[(df_clean$party == 1 | df_clean$party == 2),] # Only include D or R
```


## Importance and Context
<!-- You can (and should delete each of these comments lines in your final report) --> 
<!-- Explain why the reader should care about your research question. -->
The 2020 general election was very different from the ones that came before.
It happened in the middle of a pandemic. It elected the first ever female VP.
And it might have been the most polarized election in recent American history.
What drove people apart, among other things, is their age.

Many people suspected that the Republicans have an older supporter base than the
Democrats.

Is it just a myth or does it have some truth to it? That is what we're going to find
out in this section, using the comprehensive 2020 Time Series Study from ANES
(American National Election Studies).

## Description of Data
<!-- Explain how your research question is operationalized, including whether the variables you create are appropriate to study the concepts in question. --> 
<!-- What are some basic features of the data distribution? --> 
<!-- What changes do you make to the data and why? --> 
Looking through the CodeBook, it looks like
the variables that are useful for this question are:
- `V201018`: PARTY OF REGISTRATION
- `V201507x`: SUMMARY: RESPONDENT AGE

We removed the people who refused to answer the age question, and only left people who
are registered as either Democratic or Republican for the test because we're not
interested in other party affiliations.

We should probably talk about the fact that the maximum is cut off at 80 in the survey.

Looking at the summary of the data:
``` {r}
summary(df_clean)
hist(df_clean$party)
hist(df_clean$age)
```

## Most appropriate test 
<!-- Explain which test is the most appropriate to answer your question and why it is the most appropriate --> 
<!-- List every assumption that your test requires and evaluate it. -->
We have large sample, i.i.d. data, age is an interval variable so we can do t-test.
Because people are not registered as Democrat and Republican at the same time, there
doesn't seem to be a natural pairing going on. So we should do unpaired t-test.

## Test, results and interpretation
<!-- What are the results of your test? --> 
<!-- What do the results of this test mean? What is the practical significance? -->

Null hypothesis is the average age of Democrats and Republicans are the same.
The alternative hypothesis is that they're not. So this should be a two tailed test.

``` {r}
t.test(df_clean$age ~ df_clean$party)
```

We have very small p-value, we can reject the null and say the average ages are indeed different.

```{r, echo = FALSE, warning=FALSE, message=FALSE}
# Add categorical variable indicating Democratic or Republican
df_clean <- mutate(df_clean, party_affiliation = ifelse(party == 1, "Democratic Party", "Republican Party"))

# Find average age in each political party
av_ages <- df_clean %>%
  group_by(party_affiliation) %>%
  summarize(av_age = mean(age))

# Create density plot showing age distributions of the two parties
df_clean %>%
  ggplot() +
  aes(x = age, color = party_affiliation) +
  geom_density() + 
  geom_vline(data = av_ages, aes(xintercept=av_age, 
                                 color = party_affiliation),
             linetype = "dashed") +
  scale_color_manual(values = c("blue2", "red2")) + 
  labs(title = "Distribution of ages across political parties",
       caption = "The dotted lines represent the average age in each respective political party.") +
  theme_minimal()
```